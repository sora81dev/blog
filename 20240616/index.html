<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="icon" href="/assets/images/logo.png">

    <title>NeoPixel制御指南 | そらのサイト</title>

    <meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@sora81dev" />

<meta name="og:url" content="https://sora81.dev/20240616/">

<meta name="og:title" content="NeoPixel制御指南" />


<meta name="og:description" content="そらのサイト" />


<meta name="og:image" content="https://sora81.dev/assets/images/2024/0616/hero.png" />


    <link href="/assets/css/prism.css" rel="stylesheet">

    <link href="/assets/css/theme.css" rel="stylesheet">

    <script src="/assets/js/jquery.min.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5B4X3HXZKS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-5B4X3HXZKS');
    </script>
</head>





<body>
    <!-- defer loading of font and font awesome -->
    <noscript id="deferred-styles">
        <link href="https://fonts.googleapis.com/css?family=Sen:400,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
            integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    </noscript>

    <!-- Begin Sidebar Navigation
================================================== -->

    <div class="sidebar">
    </div>
    <div class="nav-icon">
        <div class="hamburger-bar"></div>
    </div>
    <div id="blackover-nav" class="blackover"></div>
    <nav id="menu">
        <ul>
            <h3>Navigation</h3>
            <li><a href="/">Home</a></li>
            <li><a href="/about">Profile</a></li>
            <!-- <li><a href="/authors">Contributors <span class="badge badge-primary">new</span></a></li> -->
            <!-- <li><a target="_blank" href="https://bootstrapstarter.com/jekyll-theme-memoirs/">Get Memoirs</a></li> -->
            <li><a href="/contact">Contact</a></li>
            <li><a target="_blank"></a></li>
            <li><a href="/categories">Categories</a></li>
            <li><a href="/tags">Tags</a></li>
        </ul>
    </nav>

    <script src="/assets/js/lunr.js"></script>

<style>
    
</style>

<div class="wrap-search">
    <div class="d-flex align-items-center ml-auto">
        <i class="fas fa-search show-search"></i>
        <form class="bd-search ml-3" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
            <input type="text" class="form-control bigradius text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
        </form>
    </div>
</div>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>


    <!-- End Sidebar Navigation
================================================== -->

    <div class="site-content ">

        <div class="container">

            <!-- Site Logo/Name
    ================================================== -->

            <a class="navbar-brand" href="/">
                <img src="/assets/images/logo.png" alt="そらのサイト">
            </a>


            <!-- Site Tag
    ================================================== -->
            

            <!-- Content
    ================================================== -->
            <div class="main-content">
                <div class="entry-header">
    <!-- Post Title -->
    <h1 class="posttitle">NeoPixel制御指南</h1>
    <!-- Author & Date  Box -->
    
    
    <div class="d-flex align-items-center mt-4">
        <div>
            
            <img class="author-thumb" src="/assets/images/avatar.jpg" alt="そら">
            
        </div>            
        <div>
        Written by そら on 
        <span class="post-date"><time class="post-date" datetime="2024-06-14">14 Jun 2024</time></span>           
        
        </div>            
    </div>
    
</div>

<!-- Adsense under title if enabled from _config.yml (change your pub id and slot) -->


<!-- Featured Image -->

<div class="entry-featured-image">
    
    <img class="featured-image " src="/assets/images/2024/0616/hero.png" alt="NeoPixel制御指南">
    
</div>


<!-- Content -->
<!-- Post, Page Content
================================================== -->
<div class="article-post">
    <!-- Toc if any -->
    
    <!-- End Toc -->
    <p>超お久しぶりです。<br />
最近は受験生なもので、全然したいことができてないわけなんですが、
NeoPixelを乗っけたロボットを全国大会に持っていったら案外興味を持ってくれました。</p>
<blockquote>
  <p>主に興味を持ってくれた人たち</p>
  <ul>
    <li>FTomo<a href="https://twitter.com/Ftomo_robot">@ftomo</a></li>
    <li>Yuta<a href="https://twitter.com/yuta_ciao">@yuta_ciao</a></li>
    <li>会場にいたたくさんのロボカッパーさんたち</li>
  </ul>
</blockquote>

<p>ありがとうございます</p>

<p>てなわけで。始めましょうか。</p>

<p>ひかるんばっていわれたんですけど、Root41の固有名詞ですよね…？<br />
まあ個人的にはずっと実装したかったので、うれしいです。</p>

<h2 id="今回協力していただいた方々">今回協力していただいた方々</h2>
<p>このNeoPixelの回路、プログラムの参考にした方、およびサイトを掲載させていただきます。</p>

<h3 id="協力していただいた方々">協力していただいた方々</h3>
<ul>
  <li>
    <p><a href="https://jlcpcb.jp">@JLCPCB</a><br />
スポンサーについていただいている海外企業様です。<br />
NeoPixelの基板の発注をお願いいたしました。</p>
  </li>
  <li>
    <p><a href="https://twitter.com/scramble_JPN">次世代ロボットエンジニア支援機構 Scramble</a><br />
実験にあたり、支援していただいた、ブレッドボードを使用させていただいております。<br />
ご支援、ありがとうございます。</p>
  </li>
  <li>
    <p>しろくま胡瓜<a href="https://twitter.com/shirokuma89dev">@shirokuma89dev</a><br />
今回、回路のミスがないかを見ていただきました。<br />
にしても、サタデープログラムで会うなんて奇遇ですね…</p>
  </li>
</ul>

<h3 id="参考にしたサイト">参考にしたサイト</h3>
<ul>
  <li>
    <p><a href="https://blog.shirokuma89.dev/20210424/">NeoPixel指南 ｜ しろくま胡瓜の自由帳</a></p>
  </li>
  <li>
    <p><a href="https://qiita.com/karaage0703/items/a14f759f321df99771bd">ラズパイでNeoPixel（マイコン内蔵RGB LED）を手軽に激しくLチカする方法</a></p>
  </li>
  <li>
    <p><a href="https://qiita.com/doyodoyo/items/1cc581b32f1a4458c5f2">ArduinoでNeoPixelを動かす</a></p>
  </li>
  <li>
    <p><a href="https://ameblo.jp/gameprograming/entry-12787447697.html">ArduinoでNeoPixelを動かす方法</a></p>
  </li>
  <li>
    <p><a href="https://blog.hrendoh.com/neopixel-ring-effects/">NeoPixelリングに使えるエフェクト実装例集</a></p>
  </li>
</ul>

<p>本当に、ありがとうございます。</p>

<h2 id="この記事を見るうえでの前提">この記事を見るうえでの前提</h2>
<p>この記事では、以下のことについては解説しません。</p>
<ul>
  <li>Arduinoの概要・および操作</li>
</ul>

<p>念のため環境をば</p>
<details>
  <summary>環境</summary>

  項目 | -
  -|-
  OS | Windows 11 Home 23H2
  マイコン | Arduino MEGA 2560 (ELEGOO)
  IDE | Arduino IDE 2.0.4

  ライブラリ名 | バージョン
  -|-
  Adafruit NeoPixel | 1.12.0
</details>

<p>今回は<strong>WS2812B</strong>を使用します。<br />
使用する物によって電圧が変化する場合がありますので、<strong>必ずデータシートを見てください</strong>。</p>

<p>また、今回使用したデータ（以下参照）を公開します。
公開するデータ</p>
<ul>
  <li>基板データ(Eagle)</li>
  <li>BOM, CPL</li>
  <li>今回使用するプログラム</li>
</ul>

<p>です。<br />
<a href="https://github.com/CoffeeMilk-RCJ/NeoPixel">CoffeeMilk-RCJ/NeoPixel - GitHub</a><br />
ライセンスは、CC　BY-NC-ND 4.0です。</p>
<blockquote>
  <p>現在、まだ追加完了していません</p>
</blockquote>

<h2 id="なんでそんなのつけるねん">なんでそんなのつけるねん</h2>
<p>言いたいことはわかります。<br />
理由は、<strong>デバッグのため</strong>です。<br />
以下の動画を見てください。<br />
こちらの動画では、コンパスの向きを表しています。</p>

<p>ロボカッパーの皆様なら一度は体験したことある、コンパス狂いです。
急に相手のほう向かれても困りますよね。でも、<strong>一発でわからない</strong>じゃないですか。なので実装しました。</p>

<p>また、ライトウェイトでは、有名な話ですが、<strong>白線を超えてはいけません</strong>。<br />
その時に、全体の色を変えるように変更したりすることもできます。</p>

<p>具体的には以下のような感じです（実演）</p>
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">※音声を0にしてみてください<a href="https://twitter.com/hashtag/%E4%BB%8A%E6%97%A5%E3%81%AE%E9%80%B2%E6%8D%97?src=hash&amp;ref_src=twsrc%5Etfw">#今日の進捗</a>　その1<br />・起動のアニメーション<br />・コンパスの位置を光で表す<br />・ラインの時の処理 <a href="https://t.co/HXSUUsmHEu">pic.twitter.com/HXSUUsmHEu</a></p>&mdash; そら @WSL027 (@sora81dev) <a href="https://twitter.com/sora81dev/status/1771062046945317194?ref_src=twsrc%5Etfw">March 22, 2024</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>また、<strong>色の自由度が高い</strong>です。
もし、色付きLEDで、ルールに違反する色だった場合、外すか、プログラム上から消すしかありません。<br />
しかし、NeoPixelは<strong>後から色を変更</strong>できます。</p>

<p>え？フルカラーLEDでいいって？<br />
それは次の章でわかります。</p>

<h2 id="neopixelの概要">NeoPixelの概要</h2>
<p>概要についてですが、NeoPixelという部品。ご存知でしょうか？<br />
こちらは<strong>マイコン付きLED</strong>みたいなものでして、自由に色を指定出来ちゃいます。</p>

<p>そしてそして！ここが<strong>超魅力</strong>でして、通信ケーブルが<strong>電源（2本）+通信用（1本）のみ</strong>なんですよね。個数制限？そんなのは<strong>存在しません</strong>。</p>
<blockquote>
  <p>追記✎</p>

  <p>個数制限がないといいましたが、それ相応の電源は必要になります。<br />
なので、無限ではありません。<br />
しかしながら、ロボカップで使用するぐらいなら十分すぎるぐらいだと思います。</p>
</blockquote>

<p>こんな簡単なのに<strong>超簡単に制御できちゃう</strong>って本当？<br />
はい。もちろん<strong>本当</strong>です。</p>

<p>では、さっそく、回路の設計から行きましょう。</p>

<h2 id="neopixelの回路">NeoPixelの回路</h2>
<p>これがですね、<strong>超簡単</strong>なんです。<br />
みてください。これだけです。
<img src="../assets/images/2024/0616/01.png" alt="" /></p>

<p>信じられますか？<br />
マジでこんだけです。</p>

<p>今回の回路の発注は、JLCPCBさんに依頼しました。<br />
本当にありがとうございました。</p>

<p>発注した基盤はこれです
<img src="../assets/images/2024/0616/02.png" alt="" /></p>
<blockquote>
  <p>現在、画像用意中です。</p>
</blockquote>

<p>それにPLAで3Dプリントしたカバーをつけてます。</p>

<p>では、解説行きます。
まず、あたりまえですが、電源が必要になります。
3.3Vですね。
それをNeoPixelのVCCとGNDにつなげてあげてください。
そして、<strong>PWM対応のデジタルピン</strong>をD-inにつなげてください。
これが1個めのつなげ方です。</p>

<p>2個目以降は電源をつなげて、1個めのD-outを2個めのD-inにつなげるだけです。<br />
つまり、前のD-inを次のD-outにつなげてあげるだけです。<br />
最後のD-outは繋げてはいけません。(気になるならGNDに落とすかぐらいです)</p>
<h2 id="neopixelの制御">NeoPixelの制御</h2>
<p>さて、本題に入りましょうか。<br />
まずは見てみましょう。百聞は一見に如かずです。<br />
これが必要最低限のプログラムです。</p>

<script src="https://gist.github.com/sora81dev/7acae97fab7bafabb8f6344d6f993184.js"></script>

<p>順に解説していきます。<br />
まずは定義(define)から。</p>

<table>
  <thead>
    <tr>
      <th>名称</th>
      <th>意味</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PIN</td>
      <td>NeoPixelを刺しているピン</td>
    </tr>
    <tr>
      <td>NUM_PIXELS</td>
      <td>NeoPixelの数</td>
    </tr>
  </tbody>
</table>

<p><strong>※PWM対応のデジタルピンにNeoPixelを刺してください。</strong></p>

<p>では、いよいよ光らせ方です。</p>
<h3 id="pixelsclear-で全部消そう">pixels.clear() で全部消そう</h3>
<p>これは基本です。これを入れないと消えないです。<br />
とりあえず脳死で最初に入れときましょう。</p>

<h3 id="pixelssetbrightness-で光の強さを決めよう">pixels.setBrightness() で光の強さを決めよう</h3>
<p>Brightness、日本語で光の強さという意味です。<br />
光の強さによっては目を傷めたり、ルールに違反する恐れがあるのでほどほどに。</p>

<h3 id="pixelssetpixelcolor-でどこをどんな色に光らせるかを決めよう">pixels.setPixelColor() でどこをどんな色に光らせるかを決めよう</h3>
<p>この中には2つの値を入れる必要があります。</p>
<ol>
  <li>光らせる位置</li>
  <li>色</li>
</ol>

<p>光らせる位置は普通に数字(int)で指定すればいいです。
色は少しだけ面倒で、pixels.Color(R, G, B) にRGBを突っ込んでやればうまい事光ってくれます。</p>

<p>…長々と書きましたが、<strong>めんどいですよね</strong><br />
サンプル使っちゃいましょう！！！！！<br />
使えるものは使っちゃおう！の精神で行った方が気楽ですよ。</p>

<p>では早速。
ファイル＞スケッチ例＞Adafruit NeoPixel<br />
たくさんありますね～<br />
(無かったら、ライブラリインスコしてあげてください。)<br />
さっそく、Simpleを選んでみてください。
このような画面が出てくると思います。
<img src="../assets/images/2024/0616/03.png" alt="" />
あとは先ほどと同じように、<br />
PINにNeoPixelの刺さっているピン。（PWM対応）<br />
NUMPIXELSにつなげているNeoPixelの数を入れてあげてください。<br />
そうするとうまい事行くはずです。</p>

<p>実演するとこのようになります。
※プログラムはbuttoncyclerを使用しています。</p>
<blockquote class="twitter-tweet"><p lang="ja" dir="ltr"><a href="https://twitter.com/hashtag/NeoPixel?src=hash&amp;ref_src=twsrc%5Etfw">#NeoPixel</a><br />治りました！<br />良かったです！<br />ちなみに治った原因は不明！<br /><br />Program : [Sample] buttoncycler<br /><br />Shot on SONY IXY 510 is<br />1280x720 30fps <a href="https://t.co/g20jIjjahw">https://t.co/g20jIjjahw</a> <a href="https://t.co/XxVzQQHW8a">pic.twitter.com/XxVzQQHW8a</a></p>&mdash; そら @WSL027 (@sora81dev) <a href="https://twitter.com/sora81dev/status/1770810481806094483?ref_src=twsrc%5Etfw">March 21, 2024</a></blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="バグるときは">バグるときは</h2>
<p>私自身も、なぜかバグるという現象が発生しました。それに対しての対応を見ていきましょう。</p>

<h3 id="なんか変な色がついたりするんだけど">なんか変な色がついたりするんだけど？</h3>
<p>NeoPixelは<strong>ノイズに弱いです</strong>。<br />
はんだ付けがうまい事言っているか、見てあげてください。</p>

<h3 id="うまく光らない">うまく光らない！</h3>
<p>おそらく、電流もしくは電圧が足りていないのでしょう。<br />
NeoPixelは、3.3Vの電圧を要します。<br />
また、個数が増えれば増えるほど、たくさん電流が必要になります。<br />
電源を見直してみましょう。</p>

<h2 id="それでも動かん">それでも動かん！</h2>
<p>DMしてみてください。できる限り対応します。
<a href="https://twitter.com/sora81dev">Twitter</a></p>

</div>

<!-- Rating -->


<!-- Author Box if enabled from _config.yml -->
<!-- Author Box -->




<!-- Comments if not disabled with comments: false -->
<!-- Comments
================================================== -->
 
<div class="comments mt-5">
    <button class="btn btn-outline-dark py-2 px-5 d-block w-100 show-comments"><i class="fa fa-comments text-muted"></i> &nbsp; Load Comments</button>         
    <div id="comments">  
        <h4 class="mb-4">Comments</h4>                 
            <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = ''; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
     
    <div class="clearfix"></div>              
    </div>    
</div>       


<!-- Share -->
<div class="share">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank"
                href="https://twitter.com/intent/tweet?text=NeoPixel制御指南｜そらのサイト&url=https://sora81.devhttp://localhost:4000/20240616/"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/20240616/"
                onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>
    </ul>
</div>

<!-- Related Post -->
<!-- Related Posts
================================================== -->
<div class=" related-posts ">  

    
    <h2 class="text-center mb-4">Explore more like this</h2>
    
    
    <div class="d-flex justify-content-center align-items-center">
    
    <!-- Categories -->
    
    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/categories#制御">制御</a>                
    

    <!-- Tags -->  
    
                    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/tags#RCJJ">RCJJ</a>               
    

    </div>

    
    
    
    <div class="blog-grid-container">
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        
            
            
        
            
        
            
        
        
        </div>        
</div>

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

            </div>

            

        </div>

        <!-- Begin Footer
================================================== -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <!-- <div class="col-md-6 col-sm-12 text-center text-lg-left">
                        Copyright © 2024 そらのサイト
                    </div> -->
                    <div class="col-md-6 col-sm-12 text-center text-lg-right">
                        <a target="_blank" href="https://www.wowthemes.net/memoirs-free-jekyll-theme/">Memoirs Jekyll
                            Theme</a> by WowThemes.net
                    </div>
                </div>
            </div>
        </footer>
        <!-- End Footer
================================================== -->

    </div> <!-- /.site-content -->

    <!-- Scripts (if you need bootstrap.js, please add it yourself. I didn't use it for performance reasons, it was not needed in this theme)
================================================== -->

    <script src="/assets/js/prism.js"></script>

    <script src="/assets/js/theme.js"></script>

    

    
    <script id="dsq-count-scr" src="//.disqus.com/count.js"></script>
    

</body>

</html>